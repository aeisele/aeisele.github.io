<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Don't just blindly run mvn clean install... - Ã† Software</title><meta name=Description content="Andreas Eisele, IT Consultant, Software Architect, Software Developer"><meta property="og:title" content="Don't just blindly run mvn clean install..."><meta property="og:description" content="TL;DR Believe me you almost never want to run the install goal.
If you want to create artifacts use this command:
mvn package throw in the occasional -D skipTests if you&rsquo;re feeling adventurous. ðŸ˜‰
If you want to run tests (e.g. in a CI build) use this command:
mvn verify If you&rsquo;re not convinced please keep reading.
about that maven install goal You see mvn clean install has been handed around for years as the goto command to &ldquo;build the software&rdquo;."><meta property="og:type" content="article"><meta property="og:url" content="https://www.andreaseisele.com/posts/mvn-clean-install/"><meta property="og:image" content="https://www.andreaseisele.com/posts/mvn-clean-install/craftsman.png"><meta property="article:published_time" content="2020-10-13T17:03:00+02:00"><meta property="article:modified_time" content="2020-10-13T18:12:35+02:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.andreaseisele.com/posts/mvn-clean-install/craftsman.png"><meta name=twitter:title content="Don't just blindly run mvn clean install..."><meta name=twitter:description content="TL;DR Believe me you almost never want to run the install goal.
If you want to create artifacts use this command:
mvn package throw in the occasional -D skipTests if you&rsquo;re feeling adventurous. ðŸ˜‰
If you want to run tests (e.g. in a CI build) use this command:
mvn verify If you&rsquo;re not convinced please keep reading.
about that maven install goal You see mvn clean install has been handed around for years as the goto command to &ldquo;build the software&rdquo;."><meta name=application-name content="Ã† Software"><meta name=apple-mobile-web-app-title content="Ã† Software"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.andreaseisele.com/posts/mvn-clean-install/><link rel=prev href=https://www.andreaseisele.com/posts/hibernate-np1-dto/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Don't just blindly run mvn clean install...","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.andreaseisele.com\/posts\/mvn-clean-install\/"},"image":[{"@type":"ImageObject","url":"https:\/\/www.andreaseisele.com\/posts\/mvn-clean-install\/craftsman.png","width":1600,"height":602}],"genre":"posts","keywords":"mvn, java, build system, reactor","wordcount":955,"url":"https:\/\/www.andreaseisele.com\/posts\/mvn-clean-install\/","datePublished":"2020-10-13T17:03:00+02:00","dateModified":"2020-10-13T18:12:35+02:00","publisher":{"@type":"Organization","name":"Andreas Eisele"},"author":{"@type":"Person","name":"Andreas Eisele"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('dark'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'dark'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Ã† Software"><span class=header-title-pre><span class=ae-logo>Ã† </span><span class=ae-logo-caps>S</span><span class=ae-logo>oftware</span></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title="Select Language">English<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select id=language-select-desktop onchange="location=this.value;"><option value=/posts/mvn-clean-install/ selected>English</option></select>
</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Ã† Software"><span class=header-title-pre><span class=ae-logo>Ã† </span><span class=ae-logo-caps>S</span><span class=ae-logo>oftware</span></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/categories/>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a><a href=javascript:void(0); class=menu-item title="Select Language">English<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select onchange="location=this.value;"><option value=/posts/mvn-clean-install/ selected>English</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Don't just blindly run mvn clean install...</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Andreas Eisele</a></span>&nbsp;<span class=post-category>included in <a href=/categories/programming/><i class="far fa-folder fa-fw"></i>programming</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-10-13>2020-10-13</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;955 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/posts/mvn-clean-install/craftsman.png data-srcset="/posts/mvn-clean-install/craftsman.png, /posts/mvn-clean-install/craftsman.png 1.5x, /posts/mvn-clean-install/craftsman.png 2x" data-sizes=auto alt=/posts/mvn-clean-install/craftsman.png title=/posts/mvn-clean-install/craftsman.png></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#tldr>TL;DR</a></li><li><a href=#about-that-maven-install-goal>about that maven install goal</a><ul><li><a href=#we-need-to-clean-or-do-we>we need to clean, or do we?</a></li><li><a href=#install-always-works-right>install always works, right?</a></li><li><a href=#fire-up-that-reactor>fire up that Reactor</a></li></ul></li><li><a href=#remarks>Remarks</a></li><li><a href=#links>Links</a></li></ul></nav></div></div><div class=content id=content><h2 id=tldr>TL;DR</h2><p>Believe me you almost never want to run the <code>install</code> goal.</p><p>If you want to create artifacts use this command:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>mvn package
</code></pre></div><p>throw in the occasional <code>-D skipTests</code> if you&rsquo;re feeling adventurous. ðŸ˜‰</p><p>If you want to run tests (e.g. in a CI build) use this command:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>mvn verify
</code></pre></div><p>If you&rsquo;re not convinced please keep reading.</p><h2 id=about-that-maven-install-goal>about that maven install goal</h2><p>You see <code>mvn clean install</code> has been handed around for years as the goto command to &ldquo;build the software&rdquo;. But actually it is probably doing more than you are looking for.</p><h3 id=we-need-to-clean-or-do-we>we need to clean, or do we?</h3><p>First things first: why do we prefix the command with <code>clean</code>? Well the target directory could hold outdated <em>stuff</em> right? Can you actually remember a case where this was relevant? <em>Maven</em> usually is smart enough to deal with whatever is left over in the target directory. Or should I say it is rather <em>&ldquo;dumb&rdquo;</em> enough? <em>Maven</em> tends to build more than is necessary because unlike <em>ye olde autotools</em> it doesn&rsquo;t factor in file timestamps of source and target items to reduce the workload. One could argue that in the case of <em>java</em> or <em>JVM</em> based projects this would be a tough task anyway. Not every &ldquo;.java&rdquo; file maps clearly to a pre-known output file. Think about inner or anonymous classes.</p><p>What the <code>clean</code> goal is doing is to try to delete every target folder in every module of your project. Only for it to be created again immediately by the next lifecycle phase. So my advice would be <strong>if you don&rsquo;t necessarily know why you would use clean, just don&rsquo;t</strong> it&rsquo;s gonna be fine in the most cases.</p><h3 id=install-always-works-right>install always works, right?</h3><p>If you&rsquo;ve ever had the pleasure of working with so called <em>&ldquo;multi module&rdquo;</em> projects you know the pain. <em>Maven</em> really isn&rsquo;t all that intuitive when it comes to who inter-project dependencies are resolved. Sooner or later someone will tell you &ldquo;well duh, you need to install the depencies to your local repo&rdquo; and from that point of time on running the ocassional <code>mvn clean install</code> is just daily business.</p><p>Take a look at the following simplified project structure:</p><figure><a class=lightgallery href=/posts/mvn-clean-install/multi_module.png title=/posts/mvn-clean-install/multi_module.png data-thumbnail=/posts/mvn-clean-install/multi_module.png data-sub-html="<h2>a maven multi module project</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=multi_module.png data-srcset="/posts/mvn-clean-install/multi_module.png, multi_module.png 1.5x, /posts/mvn-clean-install/multi_module.png 2x" data-sizes=auto alt=/posts/mvn-clean-install/multi_module.png></a><figcaption class=image-caption>a maven multi module project</figcaption></figure><p>We have a root project (usually called &ldquo;parent&rdquo;) and 3 child projects &ldquo;core&rdquo;, &ldquo;cli&rdquo; and &ldquo;web&rdquo;. We can also see that both &ldquo;web&rdquo; and &ldquo;cli&rdquo; depend on the &ldquo;core&rdquo; module. That&rsquo;s a pretty common structure where most of the code probably resides in the &ldquo;core&rdquo; module while different aspects like a web frontend in the web module might be relying on the core functionality.</p><p>Now the tricky question: if you change something in the core module, will the dependant cli or web modules automatically pick up those changes on the next build? As everything in IT the answer to that question of course is: <strong>it depends!</strong></p><p>The very unintuitive default for <em>maven</em> is to look up dependencies in your local <em>maven</em> repository. That is the <code>~/.m2/repostory</code> thingy. This default also applies to dependencies if they happen to be located in the very same multi module project. Now the quick fix of course is to run <code>install</code>. The problem with that of course is that now you have a fixed (snapshot?) version of your code built and copied to your local repo. This will not auto-update. Once you make further changes your dependant modules again will not <em>&ldquo;see&rdquo;</em> the changes. This can lead to frustrating cycles of debugging, remembering that you forgot to do the <em>&ldquo;install dance&rdquo;</em> and having to do the same thing all over again.</p><h3 id=fire-up-that-reactor>fire up that Reactor</h3><p>There is a way to tell <em>maven</em> to actually look for dependencies in the local project first. <em>Maven</em> does this by activating a thing called <strong>the Reactor</strong>. The funny thing is that whether <em>maven</em> actually uses the <em>reactor</em> or not is by default bound to the goal (or rather lifecycle phase) that you are trying to execute. Goals like <code>install</code>, <code>package</code> and <code>verify</code>use the <em>reactor</em> by default. This is why you might have the impression that <code>install</code> is the solution to your dependency problems. Goals like <code>compile</code> on the other hand don&rsquo;t use the <em>reactor</em> by default. They will gladly use outdated dependencies straight out of your local repo.</p><p>So what if we want to build maybe only the web artifact of that example project mentioned above? We will need to activate the reactor, to get the latest <code>core.jar</code> bundled into our <code>web.war</code>. There are two ways to do this without doing an <code>install</code> and therefore not littering our system with unnecessary artifacts:</p><ol><li>we could run a complete package from the parent (building more than necessary):</li></ol><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> root
mvn package
</code></pre></div><ol start=2><li>or we explicitly tell <em>maven</em> to build the web project and its dependencies while activating the <em>reactor</em></li></ol><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>cd</span> root
mvn compile -pl web -am
</code></pre></div><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw"></i>reactor protip<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>The take away here is that simply specifying a &ldquo;project list&rdquo; via <code>-pl</code> is enough to use the reactor.</div></div></div><p>Ever noticed the nice build summary <em>maven</em> outputs by default? It&rsquo;s actually called a <em>reactor</em> summary as you can see below:</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=o>[</span>INFO<span class=o>]</span> Reactor Summary <span class=k>for</span> parent 0.0.1-SNAPSHOT:
<span class=o>[</span>INFO<span class=o>]</span>
<span class=o>[</span>INFO<span class=o>]</span> parent ............................................. SUCCESS <span class=o>[</span>  0.011 s<span class=o>]</span>
<span class=o>[</span>INFO<span class=o>]</span> core ............................................... SUCCESS <span class=o>[</span>  1.590 s<span class=o>]</span>
<span class=o>[</span>INFO<span class=o>]</span> cli ................................................ SUCCESS <span class=o>[</span>  1.518 s<span class=o>]</span>
<span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
<span class=o>[</span>INFO<span class=o>]</span> BUILD SUCCESS
<span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
<span class=o>[</span>INFO<span class=o>]</span> Total time:  3.273 s
<span class=o>[</span>INFO<span class=o>]</span> Finished at: 2020-10-13T18:09:21+02:00
<span class=o>[</span>INFO<span class=o>]</span> ------------------------------------------------------------------------
</code></pre></div><h2 id=remarks>Remarks</h2><p>I once had a blog post with the exact same title on Marco Behler&rsquo;s <a href=https://www.marcobehler.com/blog target=_blank rel="noopener noreffer">Blog</a> back before the big redesign. By now Marco replaced that blog post with an extensive guide on Maven, you can find the link to that guide in the links section.</p><h2 id=links>Links</h2><ul><li>In dept guide about &ldquo;mvn clean install&rdquo; by <a href=https://www.marcobehler.com/guides/mvn-clean-install-a-short-guide-to-maven target=_blank rel="noopener noreffer">Marco Behler</a></li><li>Photo by <a href="https://unsplash.com/@itsmiki5?utm_source=unsplash&amp;amp;utm_medium=referral&amp;amp;utm_content=creditCopyText" target=_blank rel="noopener noreffer">Milan Popovic</a> on <a href="https://unsplash.com/s/photos/craftsman?utm_source=unsplash&amp;amp;utm_medium=referral&amp;amp;utm_content=creditCopyText" target=_blank rel="noopener noreffer">Unsplash</a></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2020-10-13</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://www.andreaseisele.com/posts/mvn-clean-install/ data-title="Don't just blindly run mvn clean install..." data-via=ae____ data-hashtags="mvn,java,build system,reactor"><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://www.andreaseisele.com/posts/mvn-clean-install/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://www.andreaseisele.com/posts/mvn-clean-install/ data-title="Don't just blindly run mvn clean install..."><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://www.andreaseisele.com/posts/mvn-clean-install/><i class="fab fa-reddit fa-fw"></i></a><a href=javascript:void(0); title="Share on Xing" data-sharer=xing data-url=https://www.andreaseisele.com/posts/mvn-clean-install/ data-title="Don't just blindly run mvn clean install..."><i class="fab fa-xing fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/mvn/>mvn</a>,&nbsp;<a href=/tags/java/>java</a>,&nbsp;<a href=/tags/build-system/>build system</a>,&nbsp;<a href=/tags/reactor/>reactor</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/hibernate-np1-dto/ class=prev rel=prev title="Prevent Hibernate from doing N+1 selects with constructor expression"><i class="fas fa-angle-left fa-fw"></i>Prevent Hibernate from doing N+1 selects with constructor expression</a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><a href=/legal>Legal</a>&nbsp;|&nbsp;<a href=/gdpr>Privacy</a></div><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.74.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Andreas Eisele</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"blog-comment","lightTheme":"github-light","repo":"aeisele/andreaseisele.com-comments"}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>