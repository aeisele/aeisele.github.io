<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Prevent Hibernate from doing N+1 selects with constructor expression - Æ Software</title><meta name=Description content="Andreas Eisele, IT Consultant, Software Architect, Software Developer"><meta property="og:title" content="Prevent Hibernate from doing N+1 selects with constructor expression"><meta property="og:description" content="The Motivation While basic CRUD operations with JPA / Hibernate are easy, every application sooner or later needs to introduce DTO style result objects for specific use cases like projections. That is part of the deal, no OR mapper can do your homework for you.
Luckily JPA gives us a way of specifying exactly what result objects we expect from a query. One way to do that is to use JPQL with its so called &lsquo;constructor expression&rsquo; in the select part of the query."><meta property="og:type" content="article"><meta property="og:url" content="https://www.andreaseisele.com/posts/hibernate-np1-dto/"><meta property="og:image" content="https://www.andreaseisele.com/posts/hibernate-np1-dto/drawers.png"><meta property="article:published_time" content="2020-09-25T13:00:14+02:00"><meta property="article:modified_time" content="2020-09-27T13:27:40+02:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.andreaseisele.com/posts/hibernate-np1-dto/drawers.png"><meta name=twitter:title content="Prevent Hibernate from doing N+1 selects with constructor expression"><meta name=twitter:description content="The Motivation While basic CRUD operations with JPA / Hibernate are easy, every application sooner or later needs to introduce DTO style result objects for specific use cases like projections. That is part of the deal, no OR mapper can do your homework for you.
Luckily JPA gives us a way of specifying exactly what result objects we expect from a query. One way to do that is to use JPQL with its so called &lsquo;constructor expression&rsquo; in the select part of the query."><meta name=application-name content="Æ Software"><meta name=apple-mobile-web-app-title content="Æ Software"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.andreaseisele.com/posts/hibernate-np1-dto/><link rel=prev href=https://www.andreaseisele.com/posts/moving-to-gh2/><link rel=next href=https://www.andreaseisele.com/posts/mvn-clean-install/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Prevent Hibernate from doing N+1 selects with constructor expression","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.andreaseisele.com\/posts\/hibernate-np1-dto\/"},"image":[{"@type":"ImageObject","url":"https:\/\/www.andreaseisele.com\/posts\/hibernate-np1-dto\/drawers.png","width":1600,"height":605}],"genre":"posts","keywords":"hibernate, jpa, sql, dto, jpql","wordcount":1235,"url":"https:\/\/www.andreaseisele.com\/posts\/hibernate-np1-dto\/","datePublished":"2020-09-25T13:00:14+02:00","dateModified":"2020-09-27T13:27:40+02:00","publisher":{"@type":"Organization","name":"Andreas Eisele"},"author":{"@type":"Person","name":"Andreas Eisele"},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':('dark'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'dark'==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Æ Software"><span class=header-title-pre><span class=ae-logo>Æ </span><span class=ae-logo-caps>S</span><span class=ae-logo>oftware</span></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title="Select Language">English<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select id=language-select-desktop onchange="location=this.value;"><option value=/posts/hibernate-np1-dto/ selected>English</option></select>
</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Æ Software"><span class=header-title-pre><span class=ae-logo>Æ </span><span class=ae-logo-caps>S</span><span class=ae-logo>oftware</span></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>Posts</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/categories/>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a><a href=javascript:void(0); class=menu-item title="Select Language">English<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select onchange="location=this.value;"><option value=/posts/hibernate-np1-dto/ selected>English</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Prevent Hibernate from doing N+1 selects with constructor expression</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Andreas Eisele</a></span>&nbsp;<span class=post-category>included in <a href=/categories/programming/><i class="far fa-folder fa-fw"></i>programming</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2020-09-25>2020-09-25</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1235 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;6 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/posts/hibernate-np1-dto/drawers.png data-srcset="/posts/hibernate-np1-dto/drawers.png, /posts/hibernate-np1-dto/drawers.png 1.5x, /posts/hibernate-np1-dto/drawers.png 2x" data-sizes=auto alt=/posts/hibernate-np1-dto/drawers.png title=/posts/hibernate-np1-dto/drawers.png></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#the-motivation>The Motivation</a></li><li><a href=#the-problem>The Problem</a></li><li><a href=#solution-1-result-transformers>Solution 1: result transformers</a><ul><li><a href=#result-transformers-with-spring-data-jpa>Result Transformers with Spring Data JPA</a></li><li><a href=#drawbacks>Drawbacks</a></li></ul></li><li><a href=#solution-2-blaze-persistence-entity-view>Solution 2: Blaze Persistence entity view</a></li><li><a href=#solution-3-use-jooq>Solution 3: use jOOQ</a></li><li><a href=#links>Links</a></li></ul></nav></div></div><div class=content id=content><h2 id=the-motivation>The Motivation</h2><p>While basic CRUD operations with <em>JPA</em> / <em>Hibernate</em> are easy, every application sooner or later
needs to introduce <em>DTO</em> style result objects for specific use cases like projections. That is part
of the deal, no OR mapper can do your homework for you.</p><p>Luckily <em>JPA</em> gives us a way of specifying exactly what result objects we expect from a query. One
way to do that is to use <em>JPQL</em> with its so called &lsquo;constructor expression&rsquo; in the select part of
the query.</p><pre><code class=language-jpaql data-lang=jpaql>select new com.example.NameDto(e.firstName, e.lastName) from Employee e
</code></pre><p>Note the <code>new</code> keyword and the fully qualified class name. This does exactly what you would think it
would do. It creates a new instance of <code>NameDto</code> using the appropriate public constructor for each
result row.</p><h2 id=the-problem>The Problem</h2><p>Using parts of an entity and projecting them into a <em>DTO</em> is fine and all but what happens if we want
to fetch the whole entity and wrap it into a <em>DTO</em>? Imagine the use case where we want to select an
entity but also some auxiliary information that is not stored along with the entity. For example
suppose we want to select &ldquo;places near me in a 2000m radius&rdquo;. That&rsquo;s only one where condition and
then you have a result set of the actual place entities right? What if we also want to show to
the end user how far away from his position those places happen to be? Why don&rsquo;t we just wrap the
<code>Place</code> entity into an appropriate <em>DTO</em> that also holds the distance, say <code>DistanceResult</code>?
Let&rsquo;s try it out.</p><p>Here we have the <code>Place</code> entity, you can see it has a location field indicating where it is located.</p><figure><a class=lightgallery href=/posts/hibernate-np1-dto/place.PNG title=/posts/hibernate-np1-dto/place.PNG data-thumbnail=/posts/hibernate-np1-dto/place.PNG data-sub-html="<h2>Place entity</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=place.PNG data-srcset="/posts/hibernate-np1-dto/place.PNG, place.PNG 1.5x, /posts/hibernate-np1-dto/place.PNG 2x" data-sizes=auto alt=/posts/hibernate-np1-dto/place.PNG></a><figcaption class=image-caption>Place entity</figcaption></figure><p>And then we a <em>DTO</em> called <code>DistanceResult</code> which should just wrap our entity together with how far
it is from the origin of the query.</p><figure><a class=lightgallery href=/posts/hibernate-np1-dto/distance_result.PNG title=/posts/hibernate-np1-dto/distance_result.PNG data-thumbnail=/posts/hibernate-np1-dto/distance_result.PNG data-sub-html="<h2>DistanceResult DTO</h2>"><img class=lazyload src=/svg/loading.min.svg data-src=distance_result.PNG data-srcset="/posts/hibernate-np1-dto/distance_result.PNG, distance_result.PNG 1.5x, /posts/hibernate-np1-dto/distance_result.PNG 2x" data-sizes=auto alt=/posts/hibernate-np1-dto/distance_result.PNG></a><figcaption class=image-caption>DistanceResult DTO</figcaption></figure><p>Prepared with that let&rsquo;s fire a simple <em>JPQL</em> query like this:</p><pre><code class=language-jpaql data-lang=jpaql>select new com.example.DistanceResult(p, distance(:center, p.location))
  from Place p
  where dwithin(:center, p.location, :radiusMeters) = true
</code></pre><p>Ignore for a moment that we are dealing with geographic types and functions here. This is actually
part of <code>hibernate-spatial</code> and I use it on an instance of <code>postgis</code> but this doesn&rsquo;t matter here.</p><p>This is what our query log gives us for that query:</p><div class=highlight><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>place1_</span><span class=p>.</span><span class=n>id</span> <span class=k>as</span> <span class=n>col_0_0_</span><span class=p>,</span> <span class=n>st_distance</span><span class=p>(</span><span class=o>?</span><span class=p>,</span> <span class=n>place0_</span><span class=p>.</span><span class=k>location</span><span class=p>)</span> <span class=k>as</span> <span class=n>col_1_0_</span> <span class=k>from</span> <span class=n>places</span> <span class=n>place0_</span> <span class=k>inner</span> <span class=k>join</span> <span class=n>places</span> <span class=n>place1_</span> <span class=k>on</span> <span class=p>(</span><span class=n>place0_</span><span class=p>.</span><span class=n>id</span><span class=o>=</span><span class=n>place1_</span><span class=p>.</span><span class=n>id</span><span class=p>)</span> <span class=k>where</span> <span class=n>st_dwithin</span><span class=p>(</span><span class=o>?</span><span class=p>,</span> <span class=n>place0_</span><span class=p>.</span><span class=k>location</span><span class=p>,</span> <span class=o>?</span><span class=p>)</span><span class=o>=</span><span class=k>true</span>

<span class=k>select</span> <span class=n>place0_</span><span class=p>.</span><span class=n>id</span> <span class=k>as</span> <span class=n>id1_0_0_</span><span class=p>,</span> <span class=n>place0_</span><span class=p>.</span><span class=k>location</span> <span class=k>as</span> <span class=n>location2_0_0_</span><span class=p>,</span> <span class=n>place0_</span><span class=p>.</span><span class=n>name</span> <span class=k>as</span> <span class=n>name3_0_0_</span> <span class=k>from</span> <span class=n>places</span> <span class=n>place0_</span> <span class=k>where</span> <span class=n>place0_</span><span class=p>.</span><span class=n>id</span><span class=o>=?</span>

<span class=k>select</span> <span class=n>place0_</span><span class=p>.</span><span class=n>id</span> <span class=k>as</span> <span class=n>id1_0_0_</span><span class=p>,</span> <span class=n>place0_</span><span class=p>.</span><span class=k>location</span> <span class=k>as</span> <span class=n>location2_0_0_</span><span class=p>,</span> <span class=n>place0_</span><span class=p>.</span><span class=n>name</span> <span class=k>as</span> <span class=n>name3_0_0_</span> <span class=k>from</span> <span class=n>places</span> <span class=n>place0_</span> <span class=k>where</span> <span class=n>place0_</span><span class=p>.</span><span class=n>id</span><span class=o>=?</span>
</code></pre></div><p>We can clearly see that our singular <em>JPQL</em> query resulted in one query that is roughly its <em>SQL</em>
equivalent. On top of that we can see additional selects one for each entity instance in our result
set (here the result size is 2). This looks like the dreaded <strong>N+1</strong> problem.</p><h2 id=solution-1-result-transformers>Solution 1: result transformers</h2><p>On one hand someone at the <em>hiberante</em> project clearly had a reasoning behind why using the constructor expression would
not fetch complete entities but rather only the immediate needed parts. On the other hand in the given use case N+1 is
nothing we want to have. Sadly there is no clear way of telling hibernate to fetch the whole entity. For example a self
join using the <code>fetch</code> keyword doesn&rsquo;t work. Also the <code>fetch all properties</code> stanza does not affect the resulting <em>SQL</em>
in this case.</p><p>Luckily there is some other way to do the <em>DTO</em> instantiation we want to have. This is <em>hibernate</em> specific and called
<code>ResultTransformer</code>. Given any <em>hibernate</em> query we can attach an instance of this interface and have our results
handled by it.</p><h3 id=result-transformers-with-spring-data-jpa>Result Transformers with Spring Data JPA</h3><p>I trust it a large part of <em>JPA</em> and/or <em>hibernate</em> users will probably be using <em>Spring Data JPA</em> to avoid boilerplate.
Here is how to use <code>ResultTransformer</code> in that case:</p><p>First we have our usual repository interface without anything fancy, note that it extends an additional interface.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Repository</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>PlaceRepository</span> <span class=kd>extends</span> <span class=n>PagingAndSortingRepository</span><span class=o>&lt;</span><span class=n>Place</span><span class=o>,</span> <span class=n>Long</span><span class=o>&gt;,</span>
    <span class=n>DistancePlaceRepository</span> <span class=o>{</span>
<span class=o>}</span>
</code></pre></div><p>This is that additional interface, we can see our distance query method is defined here.</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>DistancePlaceRepository</span> <span class=o>{</span>
    <span class=n>List</span><span class=o>&lt;</span><span class=n>DistanceResult</span><span class=o>&gt;</span> <span class=nf>findInDistance</span><span class=o>(</span><span class=n>Point</span> <span class=n>center</span><span class=o>,</span> <span class=kt>double</span> <span class=n>radiusMeters</span><span class=o>);</span>
<span class=o>}</span>
</code></pre></div><p>But how is this method implemented? We can add another <code>@Repository</code> bean into the context that implements only this
interface. <em>Spring Data JPA</em> will actually do some kind of <em>mixin</em> magic behind the covers such that our concrete
repository bean later on uses the following implementation:</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Repository</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>DistancePlaceRepositoryImpl</span> <span class=kd>implements</span> <span class=n>DistancePlaceRepository</span> <span class=o>{</span>

    <span class=nd>@PersistenceContext</span>
    <span class=kd>private</span> <span class=n>EntityManager</span> <span class=n>entityManager</span><span class=o>;</span>

    <span class=nd>@SuppressWarnings</span><span class=o>({</span><span class=s>&#34;unchecked&#34;</span><span class=o>,</span> <span class=s>&#34;deprecation&#34;</span><span class=o>})</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>DistanceResult</span><span class=o>&gt;</span> <span class=nf>findInDistance</span><span class=o>(</span><span class=n>Point</span> <span class=n>center</span><span class=o>,</span> <span class=kt>double</span> <span class=n>radiusMeters</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>String</span> <span class=n>jpql</span> <span class=o>=</span> <span class=s>&#34;select p, distance(:center, p.location) from Place p where dwithin(:center, p.location, :radiusMeters) = true&#34;</span><span class=o>;</span>

        <span class=k>return</span> <span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>DistanceResult</span><span class=o>&gt;)</span> <span class=n>entityManager</span><span class=o>.</span><span class=na>createQuery</span><span class=o>(</span><span class=n>jpql</span><span class=o>)</span>
                <span class=o>.</span><span class=na>setParameter</span><span class=o>(</span><span class=s>&#34;center&#34;</span><span class=o>,</span> <span class=n>center</span><span class=o>)</span>
                <span class=o>.</span><span class=na>setParameter</span><span class=o>(</span><span class=s>&#34;radiusMeters&#34;</span><span class=o>,</span> <span class=n>radiusMeters</span><span class=o>)</span>
                <span class=o>.</span><span class=na>unwrap</span><span class=o>(</span><span class=n>Query</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
                <span class=o>.</span><span class=na>setResultTransformer</span><span class=o>(</span>
                        <span class=o>(</span><span class=n>ListResultTransformer</span><span class=o>)</span>
                                <span class=o>(</span><span class=n>tuple</span><span class=o>,</span> <span class=n>aliases</span><span class=o>)</span> <span class=o>-&gt;</span> <span class=k>new</span> <span class=n>DistanceResult</span><span class=o>(</span>
                                        <span class=o>(</span><span class=n>Place</span><span class=o>)</span> <span class=n>tuple</span><span class=o>[</span><span class=n>0</span><span class=o>],</span>
                                        <span class=o>((</span><span class=n>Number</span><span class=o>)</span> <span class=n>tuple</span><span class=o>[</span><span class=n>1</span><span class=o>]).</span><span class=na>doubleValue</span><span class=o>()</span>
                                <span class=o>)</span>
                <span class=o>).</span><span class=na>getResultList</span><span class=o>();</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fw"></i>Warning<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>I&rsquo;m using Vlad Mihalcea&rsquo;s <code>hibernate-types</code> library here to get access to <code>ListResultTransformer</code> (See links below).</div></div></div><p>Now how does our query log look like if we use this transformer?</p><div class=highlight><pre class=chroma><code class=language-sql data-lang=sql><span class=k>select</span> <span class=n>place0_</span><span class=p>.</span><span class=n>id</span> <span class=k>as</span> <span class=n>col_0_0_</span><span class=p>,</span> <span class=n>st_distance</span><span class=p>(</span><span class=o>?</span><span class=p>,</span> <span class=n>place0_</span><span class=p>.</span><span class=k>location</span><span class=p>)</span> <span class=k>as</span> <span class=n>col_1_0_</span><span class=p>,</span> <span class=n>place0_</span><span class=p>.</span><span class=n>id</span> <span class=k>as</span> <span class=n>id1_0_</span><span class=p>,</span> <span class=n>place0_</span><span class=p>.</span><span class=k>location</span> <span class=k>as</span> <span class=n>location2_0_</span><span class=p>,</span> <span class=n>place0_</span><span class=p>.</span><span class=n>name</span> <span class=k>as</span> <span class=n>name3_0_</span> <span class=k>from</span> <span class=n>places</span> <span class=n>place0_</span> <span class=k>where</span> <span class=n>st_dwithin</span><span class=p>(</span><span class=o>?</span><span class=p>,</span> <span class=n>place0_</span><span class=p>.</span><span class=k>location</span><span class=p>,</span> <span class=o>?</span><span class=p>)</span><span class=o>=</span><span class=k>true</span>
</code></pre></div><p>As you can see its only a single select which is much better. No <strong>N+1</strong> in sight.</p><h3 id=drawbacks>Drawbacks</h3><p>The first thing you will note when trying to use <code>ResultTransformer</code> is that the actual method to use them
<code>Query#setResultTransformer</code> is marked as deprecated. This is actually some form of premature deprecation by the
<em>hibernate</em> developers. Unless you&rsquo;re using <em>hibernate</em> 6.0 there is no way around using this deprecated method. So it
is clearly fine to ignore the warning here (suppress it until 6.0 is GA and then migrate).</p><p>The second thing to note is that clearly this solution is <em>hibernate</em> specific. <code>ResultTransformer</code> is nothing <em>JPA</em>
has an equivalent of (yet).</p><h2 id=solution-2-blaze-persistence-entity-view>Solution 2: Blaze Persistence entity view</h2><p>While investigating this problem and related info on the internet I happened upon a stack overflow <a href=https://stackoverflow.com/a/64041288/222272 target=_blank rel="noopener noreffer">answer</a>
leading me to discover so called <em>&ldquo;Blaze Persistence Entity Views&rdquo;</em>. It looks like we could redefine our <em>DTO</em> with this.
I leave it as an exercise to the reader to find out via their <a href=https://persistence.blazebit.com/documentation/1.6/entity-view/manual/en_US/#spring-data-features target=_blank rel="noopener noreffer">documentation</a>
how exactly we would achieve the wrapping of the whole entity and also map the <em>distance</em> part of our original query. Its
an extensive library, I&rsquo;m sure there is a way.</p><h2 id=solution-3-use-jooq>Solution 3: use jOOQ</h2><p>Last but not least I still have to mention that of course there is nothing preventing us from just mixing our existing
<em>hibernate</em> mapping with a little bit of <a href=https://www.jooq.org/ target=_blank rel="noopener noreffer">jOOQ</a> on the side. This would give us full control over
what <em>SQL</em> exactly we are executing. And we can easily wrap the resulting tuples into our <em>DTO</em> if we want. Sure we would
have to pay attention that the result are no managed entities but in our use case this isn&rsquo;t necessary in the first place.</p><p>I said not to pay attention to the <em>spatial</em> functions earlier but if we actually want to use <em>jOOQ</em> for this kind of
query then we would need support for those <em>SQL</em> functions in the query builder. Luckily there is a project for this
on github by the name of <a href=https://github.com/dmitry-zhuravlev/jooq-postgis-spatial target=_blank rel="noopener noreffer">jooq-postgis-spatial</a> (in the case of
postgis that is).</p><h2 id=links>Links</h2><ul><li>Vlad Mihalcea on hibernate result transformers: <a href=https://vladmihalcea.com/hibernate-resulttransformer target=_blank rel="noopener noreffer">Blog Post</a></li><li>Blaze Persistence entity views <a href=https://persistence.blazebit.com/documentation/1.6/entity-view/manual/en_US/#spring-data-features target=_blank rel="noopener noreffer">documentation</a></li><li>Original Question on <a href=https://stackoverflow.com/questions/64028853/jpa-circumvent-n1-when-using-constructor-expression-in-jpql-to-wrap-singular-e target=_blank rel="noopener noreffer">stackoverflow</a></li><li>jOOQ <a href=https://www.jooq.org/ target=_blank rel="noopener noreffer">homepage</a></li><li>Photo by <a href="https://unsplash.com/@ninjason?utm_source=unsplash&amp;amp;utm_medium=referral&amp;amp;utm_content=creditCopyText" target=_blank rel="noopener noreffer">Jason Leung</a> on <a href="https://unsplash.com/s/photos/drawer?utm_source=unsplash&amp;amp;utm_medium=referral&amp;amp;utm_content=creditCopyText" target=_blank rel="noopener noreffer">Unsplash</a></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2020-09-27</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://www.andreaseisele.com/posts/hibernate-np1-dto/ data-title="Prevent Hibernate from doing N+1 selects with constructor expression" data-via=ae____ data-hashtags=hibernate,jpa,sql,dto,jpql><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://www.andreaseisele.com/posts/hibernate-np1-dto/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://www.andreaseisele.com/posts/hibernate-np1-dto/ data-title="Prevent Hibernate from doing N+1 selects with constructor expression"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://www.andreaseisele.com/posts/hibernate-np1-dto/><i class="fab fa-reddit fa-fw"></i></a><a href=javascript:void(0); title="Share on Xing" data-sharer=xing data-url=https://www.andreaseisele.com/posts/hibernate-np1-dto/ data-title="Prevent Hibernate from doing N+1 selects with constructor expression"><i class="fab fa-xing fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/hibernate/>hibernate</a>,&nbsp;<a href=/tags/jpa/>jpa</a>,&nbsp;<a href=/tags/sql/>sql</a>,&nbsp;<a href=/tags/dto/>dto</a>,&nbsp;<a href=/tags/jpql/>jpql</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/moving-to-gh2/ class=prev rel=prev title="Moving to GitHub Pages, Pt.2"><i class="fas fa-angle-left fa-fw"></i>Moving to GitHub Pages, Pt.2</a>
<a href=/posts/mvn-clean-install/ class=next rel=next title="Don't just blindly run mvn clean install...">Don't just blindly run mvn clean install...<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><a href=/legal>Legal</a>&nbsp;|&nbsp;<a href=/gdpr>Privacy</a></div><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.74.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i>LoveIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Andreas Eisele</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"blog-comment","lightTheme":"github-light","repo":"aeisele/andreaseisele.com-comments"}},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>